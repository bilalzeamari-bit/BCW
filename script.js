const translations = {
  fr: {
    brand: {
      tagline: "Secondaire - Enseignement superieur",
    },
    nav: {
      offer: "Offre",
      subjects: "Matieres",
      method: "Methode",
      faq: "FAQ",
      contactPage: "Page contact",
      register: "S'inscrire",
    },
    hero: {
      pillFormats: "Bruxelles - En ligne - A domicile",
      pillFast: "Reponse rapide",
      title: "Cours particuliers exigeants pour progresser durablement.",
      subtitle:
        "BCW accompagne les eleves du secondaire et les etudiants de l'enseignement superieur a Bruxelles, en ligne et a domicile, avec un suivi rigoureux et humain.",
      ctaPrimary: "Demander un cours",
      ctaSecondary: "Appeler",
    },
    trust: {
      title: "Pourquoi les familles nous font confiance",
      subtitle:
        "Une equipe de 3 diplomes Solvay Brussels School, un cadre clair et un accompagnement constant.",
      card1: {
        title: "Equipe experimentee",
        text: "Cours assures par des profils academiques solides, habitues aux objectifs d'examen.",
      },
      card2: {
        title: "Cadre sur mesure",
        text: "Chaque eleve suit un plan adapte au niveau, au rythme et aux priorites.",
      },
      card3: {
        title: "Communication rapide",
        text: "Retour sous 24h ouvrables pour organiser le format, la matiere et le planning.",
      },
      card4: {
        title: "Resultats mesurables",
        text: "Objectifs fixes en amont, progression suivie apres chaque seance.",
      },
    },
    offer: {
      title: "Notre offre d'accompagnement",
      subtitle:
        "Pas de prix affiche: nous preparons un devis personnalise selon niveau, matiere et format.",
      secondary: {
        title: "Secondaire",
        text: "Consolidation des bases, preparation d'examens, remediations ciblees et methode de travail.",
        point1: "Mathematiques, sciences, langues et plus",
        point2: "Suivi continu avec objectifs hebdomadaires",
        point3: "Format individuel ou mini-groupe",
      },
      higher: {
        title: "Enseignement superieur",
        text: "Appui methodologique et academique pour valider les cours exigeants et preparer les evaluations.",
        point1: "Finance, comptabilite, statistiques, langues",
        point2: "Preparation de travaux et examens",
        point3: "Approche structuree orientee performance",
      },
    },
    formats: {
      title: "Formats",
      subtitle: "Trois modalites simples pour s'adapter au planning de chaque famille.",
      card1: {
        title: "En ligne",
        text: "Cours interactifs avec partage d'ecran, supports et exercices en direct.",
      },
      card2: {
        title: "A domicile",
        text: "Accompagnement dans un cadre familier, avec suivi personnalise.",
      },
      card3: {
        title: "Bruxelles",
        text: "Sessions presencielles en ville selon disponibilites et localisation.",
      },
    },
    subjects: {
      title: "Matieres couvertes",
      subtitle:
        "Nous couvrons les matieres principales du secondaire et de l'enseignement superieur.",
      card1: {
        title: "Mathematiques & sciences",
        text: "Maths, physique, chimie, statistiques et raisonnement scientifique.",
      },
      card2: {
        title: "Langues & communication",
        text: "Francais, neerlandais, anglais, methodologie redactionnelle et orale.",
      },
      card3: {
        title: "Finance & comptabilite",
        text: "Principes comptables, analyse financiere, exercices et cas pratiques.",
      },
    },
    method: {
      title: "Methode & suivi",
      subtitle: "Un processus clair en 3 etapes, identique pour tous les formats.",
      card1: {
        title: "1. Diagnostic",
        text: "Evaluation rapide des acquis, blocages et priorites academiques.",
      },
      card2: {
        title: "2. Plan",
        text: "Plan de seances ciblees avec objectifs precis et exercices adaptes.",
      },
      card3: {
        title: "3. Feedback",
        text: "Compte-rendu regulier pour ajuster la trajectoire et valider les progres.",
      },
    },
    testimonials: {
      title: "Temoignages",
      subtitle: "Quelques retours recents de familles et d'etudiants accompagnes.",
      card1: {
        quote:
          '"Encadrement tres serieux, notre fils a repris confiance en maths en quelques semaines."',
        author: "Parent - Bruxelles",
      },
      card2: {
        quote:
          '"Methodologie claire pour mes examens de finance. Suivi efficace et humain."',
        author: "Etudiante - Enseignement superieur",
      },
      card3: {
        quote:
          '"Disponibilite rapide et explications tres pedagogiques pour les sciences."',
        author: "Parent - Brabant",
      },
    },
    faq: {
      title: "FAQ",
      q1: "Pourquoi n'affichez-vous pas les prix ?",
      a1: "Chaque demande est differente. Nous envoyons un devis personnalise selon niveau, matiere, format et frequence.",
      q2: "Intervenez-vous uniquement a Bruxelles ?",
      a2: "Nous couvrons Bruxelles en presentiel et proposons aussi des cours en ligne selon les besoins.",
      q3: "Prenez-vous l'enseignement superieur ?",
      a3: "Oui, notamment pour les matieres quantitatives, langues, finance et comptabilite.",
      q4: "Sous quel delai etes-vous disponibles ?",
      a4: "Nous revenons rapidement avec une proposition adaptee, en general sous 24h ouvrables.",
      q5: "Comment se passe le demarrage ?",
      a5: "Apres votre demande, nous validons objectifs et disponibilites puis planifions la premiere seance.",
    },
    contact: {
      title: "Contact",
      subtitle:
        "Decrivez votre besoin. Nous revenons vers vous avec un plan et un devis personnalise.",
      directTitle: "Contact direct",
      directText:
        "Appelez ou ecrivez via WhatsApp. Remplacez les placeholders par vos numeros.",
      pageLink: "Ouvrir la page contact",
      signupTitle: "Demande de cours premium",
      signupText:
        "Le formulaire complet est centralise sur la page Inscription pour une prise en charge plus rapide et structuree.",
      signupPoint1: "Formulaire detaille en moins de 2 minutes",
      signupPoint2: "Analyse rapide de votre besoin",
      signupPoint3: "Retour avec plan d'accompagnement et devis",
      signupCta: "Ouvrir l'inscription",
    },
    form: {
      title: "Demande de cours",
      nameLabel: "Nom",
      namePlaceholder: "Votre nom",
      emailLabel: "Email",
      emailPlaceholder: "vous@email.com",
      phoneLabel: "Telephone",
      phonePlaceholder: "+32 ...",
      levelLabel: "Niveau",
      levelPlaceholder: "Selectionnez un niveau",
      levelSecondary: "Secondaire",
      levelHigher: "Enseignement superieur",
      subjectLabel: "Matiere",
      subjectPlaceholder: "Ex: mathematiques",
      messageLabel: "Message",
      messagePlaceholder: "Contexte, disponibilites, objectif...",
      submit: "Envoyer la demande",
      sending: "Envoi en cours...",
      success: "Merci. Votre demande a bien ete envoyee.",
      honeypot: "Envoi bloque.",
      fallback: "Erreur d'envoi. Verifiez la configuration Supabase (table/policy) puis reessayez.",
      invalid: "Veuillez completer les champs obligatoires.",
      messageTooShort: "Le message doit contenir au moins 10 caracteres.",
      mailSubject: "Demande de cours BCW",
    },
    footer: {
      text: "Cours particuliers premium a Bruxelles, en ligne et a domicile.",
      backTop: "Retour en haut",
      register: "Inscription",
      contact: "Contact",
    },
  },
  nl: {
    brand: {
      tagline: "Secundair - Hoger onderwijs",
    },
    nav: {
      offer: "Aanbod",
      subjects: "Vakken",
      method: "Methode",
      faq: "FAQ",
      contactPage: "Contactpagina",
      register: "Inschrijven",
    },
    hero: {
      pillFormats: "Brussel - Online - Aan huis",
      pillFast: "Snelle reactie",
      title: "Doelgerichte bijles om duurzaam vooruit te gaan.",
      subtitle:
        "BCW begeleidt leerlingen uit het secundair en studenten in het hoger onderwijs in Brussel, online en aan huis, met een strikte en menselijke aanpak.",
      ctaPrimary: "Vraag een les aan",
      ctaSecondary: "Bellen",
    },
    trust: {
      title: "Waarom gezinnen ons vertrouwen",
      subtitle:
        "Een team van 3 afgestudeerden van Solvay Brussels School, met duidelijke structuur en constante opvolging.",
      card1: {
        title: "Ervaren team",
        text: "Lessen gegeven door sterke academische profielen met focus op examendoelen.",
      },
      card2: {
        title: "Maatwerk",
        text: "Elke leerling volgt een plan op maat van niveau, ritme en prioriteiten.",
      },
      card3: {
        title: "Snelle communicatie",
        text: "Binnen 24 werkuren antwoord over format, vak en planning.",
      },
      card4: {
        title: "Meetbare vooruitgang",
        text: "Doelen vooraf bepaald, voortgang na elke sessie opgevolgd.",
      },
    },
    offer: {
      title: "Ons begeleidingsaanbod",
      subtitle:
        "Geen vaste prijs op de site: we maken een offerte op maat volgens niveau, vak en format.",
      secondary: {
        title: "Secundair",
        text: "Versterking van basiskennis, examenvoorbereiding, gerichte remediëring en studiemethode.",
        point1: "Wiskunde, wetenschappen, talen en meer",
        point2: "Continue opvolging met wekelijkse doelen",
        point3: "Individueel of in mini-groep",
      },
      higher: {
        title: "Hoger onderwijs",
        text: "Methodologische en academische ondersteuning voor uitdagende vakken en evaluaties.",
        point1: "Financiën, boekhouding, statistiek, talen",
        point2: "Voorbereiding van opdrachten en examens",
        point3: "Gestructureerde aanpak gericht op resultaat",
      },
    },
    formats: {
      title: "Formats",
      subtitle: "Drie duidelijke opties die aansluiten op elke agenda.",
      card1: {
        title: "Online",
        text: "Interactieve lessen met schermdeling, materiaal en oefeningen in realtime.",
      },
      card2: {
        title: "Aan huis",
        text: "Begeleiding in vertrouwde omgeving met persoonlijke opvolging.",
      },
      card3: {
        title: "Brussel",
        text: "Fysieke sessies in Brussel volgens beschikbaarheid en locatie.",
      },
    },
    subjects: {
      title: "Gedekte vakken",
      subtitle: "Wij begeleiden in de belangrijkste vakken van secundair en hoger onderwijs.",
      card1: {
        title: "Wiskunde & wetenschappen",
        text: "Wiskunde, fysica, chemie, statistiek en wetenschappelijk redeneren.",
      },
      card2: {
        title: "Talen & communicatie",
        text: "Frans, Nederlands, Engels, schrijfvaardigheid en mondelinge presentatie.",
      },
      card3: {
        title: "Financiën & boekhouding",
        text: "Boekhoudprincipes, financiële analyse, oefeningen en praktijkcases.",
      },
    },
    method: {
      title: "Methode & opvolging",
      subtitle: "Een helder proces in 3 stappen, gelijk voor alle formats.",
      card1: {
        title: "1. Diagnose",
        text: "Snelle evaluatie van kennis, blokkades en academische prioriteiten.",
      },
      card2: {
        title: "2. Plan",
        text: "Gericht lesplan met duidelijke doelen en aangepaste oefeningen.",
      },
      card3: {
        title: "3. Feedback",
        text: "Regelmatige terugkoppeling om de aanpak bij te sturen en vooruitgang te bevestigen.",
      },
    },
    testimonials: {
      title: "Getuigenissen",
      subtitle: "Enkele recente reacties van gezinnen en studenten.",
      card1: {
        quote:
          '"Zeer professionele begeleiding. Onze zoon kreeg opnieuw vertrouwen in wiskunde."',
        author: "Ouder - Brussel",
      },
      card2: {
        quote:
          '"Heldere methode voor mijn examens financiën. Efficiënte en menselijke opvolging."',
        author: "Studente - Hoger onderwijs",
      },
      card3: {
        quote:
          '"Snelle beschikbaarheid en heel pedagogische uitleg voor wetenschappen."',
        author: "Ouder - Brabant",
      },
    },
    faq: {
      title: "FAQ",
      q1: "Waarom tonen jullie geen prijzen?",
      a1: "Elke aanvraag is anders. We sturen een offerte op maat volgens niveau, vak, format en frequentie.",
      q2: "Werken jullie alleen in Brussel?",
      a2: "We geven fysieke lessen in Brussel en bieden ook online begeleiding aan.",
      q3: "Begeleiden jullie ook hoger onderwijs?",
      a3: "Ja, vooral voor kwantitatieve vakken, talen, financiën en boekhouding.",
      q4: "Hoe snel zijn jullie beschikbaar?",
      a4: "We reageren snel met een voorstel op maat, meestal binnen 24 werkuren.",
      q5: "Hoe start de begeleiding?",
      a5: "Na je aanvraag stemmen we doelen en planning af en plannen we de eerste sessie.",
    },
    contact: {
      title: "Contact",
      subtitle:
        "Beschrijf je noden. We komen bij je terug met een plan en een offerte op maat.",
      directTitle: "Direct contact",
      directText: "Bel of stuur via WhatsApp. Vervang de placeholders door jullie nummers.",
      pageLink: "Open contactpagina",
      signupTitle: "Premium lesaanvraag",
      signupText:
        "Het volledige formulier staat op de inschrijvingspagina voor snellere en beter gestructureerde opvolging.",
      signupPoint1: "Volledig formulier in minder dan 2 minuten",
      signupPoint2: "Snelle analyse van je behoefte",
      signupPoint3: "Reactie met begeleidingsplan en offerte",
      signupCta: "Open inschrijving",
    },
    form: {
      title: "Lesaanvraag",
      nameLabel: "Naam",
      namePlaceholder: "Jouw naam",
      emailLabel: "E-mail",
      emailPlaceholder: "jij@email.com",
      phoneLabel: "Telefoon",
      phonePlaceholder: "+32 ...",
      levelLabel: "Niveau",
      levelPlaceholder: "Selecteer een niveau",
      levelSecondary: "Secundair",
      levelHigher: "Hoger onderwijs",
      subjectLabel: "Vak",
      subjectPlaceholder: "Bv. wiskunde",
      messageLabel: "Bericht",
      messagePlaceholder: "Context, beschikbaarheid, doel...",
      submit: "Verstuur aanvraag",
      sending: "Verzenden...",
      success: "Bedankt. Je aanvraag werd goed verzonden.",
      honeypot: "Verzending geblokkeerd.",
      fallback: "Verzendfout. Controleer de Supabase-configuratie (tabel/policy) en probeer opnieuw.",
      invalid: "Vul de verplichte velden in.",
      messageTooShort: "Je bericht moet minstens 10 tekens bevatten.",
      mailSubject: "BCW lesaanvraag",
    },
    footer: {
      text: "Premium bijles in Brussel, online en aan huis.",
      backTop: "Terug naar boven",
      register: "Inschrijving",
      contact: "Contact",
    },
  },
};

const STORAGE_KEY = "bcw-lang";
const DEFAULT_LANG = "fr";
const SUPABASE_URL = "https://kiwuncwivajenqyinrqb.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "sb_publishable_sxowccgePeTvJjwF68CIhQ_KMqiYTTw";

const burger = document.querySelector(".burger");
const nav = document.querySelector("header nav");
const year = document.getElementById("year");
const langButtons = document.querySelectorAll(".lang-btn");
const contactForm = document.getElementById("contact-form");
const formStatus = document.getElementById("form-status");

if (year) {
  year.textContent = String(new Date().getFullYear());
}

if (burger && nav) {
  burger.addEventListener("click", () => {
    nav.classList.toggle("open");
    burger.setAttribute("aria-expanded", nav.classList.contains("open") ? "true" : "false");
  });
}

document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
  anchor.addEventListener("click", (event) => {
    const href = anchor.getAttribute("href");
    if (!href || href === "#") {
      return;
    }

    const target = document.querySelector(href);
    if (!target) {
      return;
    }

    event.preventDefault();
    target.scrollIntoView({ behavior: "smooth", block: "start" });

    if (nav) {
      nav.classList.remove("open");
    }
    if (burger) {
      burger.setAttribute("aria-expanded", "false");
    }
  });
});

function getNestedValue(source, path) {
  return path.split(".").reduce((acc, key) => {
    if (!acc || typeof acc !== "object") {
      return undefined;
    }
    return acc[key];
  }, source);
}

function getStoredLanguage() {
  const stored = localStorage.getItem(STORAGE_KEY);
  if (stored && translations[stored]) {
    return stored;
  }
  return DEFAULT_LANG;
}

function setActiveLanguageButton(language) {
  langButtons.forEach((button) => {
    button.classList.toggle("is-active", button.dataset.lang === language);
  });
}

function applyTranslations(language) {
  const dictionary = translations[language] || translations[DEFAULT_LANG];

  document.documentElement.lang = language;

  document.querySelectorAll("[data-i18n]").forEach((node) => {
    const key = node.getAttribute("data-i18n");
    const value = getNestedValue(dictionary, key);
    if (typeof value === "string") {
      node.textContent = value;
    }
  });

  document.querySelectorAll("[data-i18n-placeholder]").forEach((node) => {
    const key = node.getAttribute("data-i18n-placeholder");
    const value = getNestedValue(dictionary, key);
    if (typeof value === "string") {
      node.setAttribute("placeholder", value);
    }
  });

  localStorage.setItem(STORAGE_KEY, language);
  setActiveLanguageButton(language);
}

langButtons.forEach((button) => {
  button.addEventListener("click", () => {
    const language = button.dataset.lang;
    if (!language || !translations[language]) {
      return;
    }
    applyTranslations(language);
  });
});

applyTranslations(getStoredLanguage());

function messageForCurrentLanguage(key) {
  const language = getStoredLanguage();
  const dictionary = translations[language] || translations[DEFAULT_LANG];
  const value = getNestedValue(dictionary, key);
  return typeof value === "string" ? value : "";
}

function setFormStatus(message, type = "info") {
  if (!formStatus) {
    return;
  }
  formStatus.textContent = message;
  formStatus.classList.remove("is-info", "is-success", "is-error");
  if (type === "success") {
    formStatus.classList.add("is-success");
  } else if (type === "error") {
    formStatus.classList.add("is-error");
  } else {
    formStatus.classList.add("is-info");
  }
}

if (contactForm && formStatus) {
  contactForm.addEventListener("submit", async (event) => {
    event.preventDefault();

    if (!contactForm.checkValidity()) {
      contactForm.reportValidity();
      setFormStatus(messageForCurrentLanguage("form.invalid"), "error");
      return;
    }

    const honeypotField = contactForm.querySelector('input[name="website"]');
    if (honeypotField && honeypotField.value.trim()) {
      setFormStatus(messageForCurrentLanguage("form.honeypot"), "error");
      return;
    }

    const formData = new FormData(contactForm);
    const payload = Object.fromEntries(formData.entries());
    delete payload.website;

    const submitButton = contactForm.querySelector('button[type="submit"]');
    const originalButtonLabel = submitButton ? submitButton.textContent : "";
    if (submitButton) {
      submitButton.disabled = true;
      submitButton.textContent = messageForCurrentLanguage("form.sending");
      submitButton.setAttribute("aria-busy", "true");
    }
    setFormStatus(messageForCurrentLanguage("form.sending"), "info");

    try {
      const response = await fetch(`${SUPABASE_URL}/rest/v1/leads`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          apikey: SUPABASE_PUBLISHABLE_KEY,
          Authorization: `Bearer ${SUPABASE_PUBLISHABLE_KEY}`,
          Prefer: "return=minimal",
        },
        body: JSON.stringify({
          name: payload.name,
          email: payload.email,
          phone: payload.phone,
          level: payload.level,
          subject: payload.subject,
          format: payload.format || null,
          urgency: payload.urgency || null,
          message: payload.message,
          source: "website",
        }),
      });

      if (!response.ok) {
        let errorDetails = "";
        try {
          const errorJson = await response.json();
          errorDetails = errorJson?.message || JSON.stringify(errorJson);
        } catch {
          errorDetails = await response.text();
        }
        throw new Error(`Supabase insert failed (${response.status}): ${errorDetails}`);
      }

      setFormStatus(messageForCurrentLanguage("form.success"), "success");
      contactForm.reset();
      const successUrl = contactForm.getAttribute("data-success-url") || "merci.html";
      setTimeout(() => {
        window.location.href = successUrl;
      }, 650);
    } catch (error) {
      console.error(error);
      const errorText = String(error?.message || error || "");
      if (errorText.includes("leads_message_check")) {
        setFormStatus(messageForCurrentLanguage("form.messageTooShort"), "error");
      } else {
        setFormStatus(messageForCurrentLanguage("form.fallback"), "error");
      }
    } finally {
      if (submitButton) {
        submitButton.disabled = false;
        submitButton.removeAttribute("aria-busy");
        if (submitButton.hasAttribute("data-i18n")) {
          applyTranslations(getStoredLanguage());
        } else {
          submitButton.textContent = originalButtonLabel;
        }
      }
    }
  });
}

function initRevealAnimation() {
  if (!window.IntersectionObserver) {
    return;
  }

  const targets = document.querySelectorAll(
    ".card, .offer-card, .testimonial-card, .faq-item, .contact-card"
  );

  const observer = new IntersectionObserver(
    (entries, currentObserver) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("is-visible");
          currentObserver.unobserve(entry.target);
        }
      });
    },
    {
      threshold: 0.14,
      rootMargin: "0px 0px -40px 0px",
    }
  );

  targets.forEach((target) => {
    target.classList.add("reveal");
    observer.observe(target);
  });
}

initRevealAnimation();
